<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Hugo Périlleux">

<title>TP09 - Analyse en Composante Principale (ACP)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="TP9_ACP_files/libs/clipboard/clipboard.min.js"></script>
<script src="TP9_ACP_files/libs/quarto-html/quarto.js"></script>
<script src="TP9_ACP_files/libs/quarto-html/popper.min.js"></script>
<script src="TP9_ACP_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="TP9_ACP_files/libs/quarto-html/anchor.min.js"></script>
<link href="TP9_ACP_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="TP9_ACP_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="TP9_ACP_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="TP9_ACP_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="TP9_ACP_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">TP09 - Analyse en Composante Principale (ACP)</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Hugo Périlleux </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="objectif" class="level1">
<h1>Objectif:</h1>
<p>L’objectif de ce TP est de réaliser une analyse en composante principale sur base de données électorales.</p>
</section>
<section id="ressources-utilisées" class="level1">
<h1>Ressources utilisées:</h1>
<ul>
<li><p><a href="http://www.sthda.com/english/wiki/wiki.php?id_contents=7851" class="uri">http://www.sthda.com/english/wiki/wiki.php?id_contents=7851</a></p></li>
<li><p><a href="http://factominer.free.fr/index_fr.html" class="uri">http://factominer.free.fr/index_fr.html</a></p></li>
</ul>
</section>
<section id="données" class="level1">
<h1>Données:</h1>
<ul>
<li>données des élections présidentielles 2022 par communes : pres2022comm.csv (<a href="https://unehistoireduconflitpolitique.fr/telecharger.html" class="uri">https://unehistoireduconflitpolitique.fr/telecharger.html</a>)</li>
</ul>
<p>Ce fichier contient les résultats des élections présidentielles de 2022 en format csv. Ces fichiers ont été générés à partir des résultats électoraux disponibles sur le site du Ministère de l’Intérieur et sur data.gouv.fr. J. Cagé et T. Piketty (2023) : Une histoire du conflit politique. Élections et inégalités sociales en France, 1789-2022. Le Seuil.</p>
<ul>
<li><p>communes: communes-20220101.shp (1)</p></li>
<li><p>arrondissement municipaux: arrondissements_municipaux-20180711.shp (2)</p></li>
<li><p>table commune - région : commune2021.csv (3)</p></li>
<li><p>revenus par commune : FILO2021_DEC_COM.xlsx (4)</p></li>
<li><p>population par commune: population_insee_2021.xlsx (5)</p></li>
</ul>
<ol type="1">
<li>INSEE: <a href="https://www.data.gouv.fr/fr/datasets/decoupage-administratif-communal-francais-issu-d-openstreetmap/" class="uri">https://www.data.gouv.fr/fr/datasets/decoupage-administratif-communal-francais-issu-d-openstreetmap/</a></li>
<li>INSEE: <a href="https://www.data.gouv.fr/fr/datasets/decoupage-administratif-communal-francais-issu-d-openstreetmap/" class="uri">https://www.data.gouv.fr/fr/datasets/decoupage-administratif-communal-francais-issu-d-openstreetmap/</a></li>
<li>INSEE: <a href="https://www.insee.fr/fr/information/2560452" class="uri">https://www.insee.fr/fr/information/2560452</a></li>
<li>INSEE: <a href="https://www.insee.fr/fr/statistiques/7756855?sommaire=7756859" class="uri">https://www.insee.fr/fr/statistiques/7756855?sommaire=7756859</a></li>
<li>INSEE : <a href="https://www.insee.fr/fr/statistiques/7739582?sommaire=7728826" class="uri">https://www.insee.fr/fr/statistiques/7739582?sommaire=7728826</a></li>
</ol>
<p>Pour ce TP nous utiliserons les packages suivants:</p>
<p>De façon maintenant habituelle:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.1     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.1
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Linking to GEOS 3.11.2, GDAL 3.8.2, PROJ 9.3.1; sf_use_s2() is TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mapsf)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(remotes) </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">#install_version("estimability", "1.4.1")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Et deux packages développés pour réaliser des ACP et visualiser les résultats:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("FactoMineR") </span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("factoextra")</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(FactoMineR)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Welcome! Want to learn more? See two factoextra-related books at https://goo.gl/ve3WBa</code></pre>
</div>
</div>
<p>Les objectifs pour réaliser une ACP sont généralement :</p>
<ol type="1">
<li><p>Débroussailler un large set de données avec plein de variables</p></li>
<li><p>Réaliser un indicateur synthétique</p></li>
<li><p>Préparer à une classification</p></li>
</ol>
<p>Dans le cas ici, on va plutôt réaliser une ACP suivant le premier objectif sur les votes exprimés aux élections en Île de France aux élections présidentielles de 2022. L’objectif sera de voir on retrouve des structures dans la géographie de cette élection.</p>
</section>
<section id="importation-des-données" class="level1">
<h1>1. Importation des données</h1>
<section id="élections-2022" class="level2">
<h2 class="anchored" data-anchor-id="élections-2022">1.1. Élections 2022</h2>
<p>Importation des données:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>data<span class="ot">&lt;-</span><span class="fu">read_delim</span>(<span class="st">"../data/France/pres2022comm.csv"</span>, <span class="at">delim=</span><span class="st">","</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">19</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(codecommune<span class="sc">!=</span><span class="st">"75056"</span>) <span class="co"># %&gt;% # On enlève la communes de Paris</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 34867 Columns: 97
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (4): dep, nomdep, codecommune, nomcommune
dbl (93): inscrits, votants, exprimes, voixARTHAUD, voixPOUTOU, voixROUSSEL,...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<p>On prend une table pour ne sélectionner que l’Île de France:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>communes_table<span class="ot">&lt;-</span><span class="fu">read_delim</span>(<span class="st">"../data/France/commune2021.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 37742 Columns: 12
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (11): TYPECOM, COM, REG, DEP, CTCD, ARR, NCC, NCCENR, LIBELLE, CAN, COMP...
dbl  (1): TNCC

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>data<span class="ot">&lt;-</span>data <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(communes_table, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"codecommune"</span><span class="ot">=</span><span class="st">"COM"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(REG<span class="sc">==</span><span class="dv">11</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="dv">20</span><span class="sc">:</span><span class="dv">30</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="communes" class="level2">
<h2 class="anchored" data-anchor-id="communes">1.2. Communes</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>communes<span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"../data/France/communes_arrond_ile_de_france.gpkg"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(insee<span class="sc">!=</span><span class="st">"75056"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `communes_arrond_ile_de_france' from data source 
  `C:\Users\hugop\Nextcloud\git\GEO_QUANTI\data\France\communes_arrond_ile_de_france.gpkg' 
  using driver `GPKG'
Simple feature collection with 1287 features and 4 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 1.446244 ymin: 48.12015 xmax: 3.559221 ymax: 49.24143
Geodetic CRS:  WGS 84</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On importe les arrondissements de Paris, Lyon et Marseille</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>arrond_lyon_mars_paris<span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"../data/France/arrondissements_municipaux-20180711-shp/arrondissements_municipaux-20180711.shp"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>surf_km2) <span class="sc">%&gt;%</span> </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">geom=</span>geometry)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `arrondissements_municipaux-20180711' from data source 
  `C:\Users\hugop\Nextcloud\git\GEO_QUANTI\data\France\arrondissements_municipaux-20180711-shp\arrondissements_municipaux-20180711.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 45 features and 4 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 2.224122 ymin: 43.19714 xmax: 5.532476 ymax: 48.90216
Geodetic CRS:  WGS 84</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>communes<span class="ot">&lt;-</span><span class="fu">bind_rows</span>(communes,arrond_lyon_mars_paris) <span class="co"># On joint communes et arrondissements</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(arrond_lyon_mars_paris)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On ne garde que les communes de l’Ile de France:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>communes<span class="ot">&lt;-</span>communes <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(communes_table, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"insee"</span><span class="ot">=</span><span class="st">"COM"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(REG<span class="sc">==</span><span class="dv">11</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">15</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in sf_column %in% names(g): Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 17 of `x` matches multiple rows in `y`.
ℹ Row 31675 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
</div>
<p>On calcul la densité par communes:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>communes<span class="ot">&lt;-</span>communes <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">surface=</span><span class="fu">as.numeric</span>(<span class="fu">st_area</span>(geom))<span class="sc">/</span><span class="dv">10000</span>) <span class="co"># On calcul le superficie de chaque communes</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On créé un objet département pour la cartographie:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>departements_Paris<span class="ot">&lt;-</span>communes <span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(communes_table, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"insee"</span><span class="ot">=</span><span class="st">"COM"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(REG<span class="sc">==</span><span class="dv">11</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(DEP,REG) <span class="sc">%&gt;%</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">geom=</span><span class="fu">st_union</span>(geom))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in sf_column %in% names(g): Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 17 of `x` matches multiple rows in `y`.
ℹ Row 31675 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'DEP'. You can override using the `.groups`
argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(communes_table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="recodage" class="level1">
<h1>2. Recodage</h1>
<p>Pour réaliser l’ACP il faut d’abord recoder les variables. On utilise généralement des variables en proportion:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>data<span class="ot">&lt;-</span>data <span class="sc">%&gt;%</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ARTHAUD=</span>voixARTHAUD<span class="sc">/</span>exprimes,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">POUTOU=</span>voixPOUTOU<span class="sc">/</span>exprimes,</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">ROUSSEL=</span>voixROUSSEL<span class="sc">/</span>exprimes,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">MELENCHON=</span>voixMELENCHON<span class="sc">/</span>exprimes,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">JADOT=</span>voixJADOT<span class="sc">/</span>exprimes,</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">HIDALGO=</span>voixHIDALGO<span class="sc">/</span>exprimes,</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">LASSALLE=</span>voixLASSALLE<span class="sc">/</span>exprimes,</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">MACRON=</span>voixMACRON<span class="sc">/</span>exprimes,</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">PECRESSE=</span>voixPECRESSE<span class="sc">/</span>exprimes,</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">ZEMMOUR=</span>voixZEMMOUR<span class="sc">/</span>exprimes,</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">DUPONTAIGNAN=</span>voixDUPONTAIGNAN<span class="sc">/</span>exprimes,</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">MLEPEN=</span>voixMLEPEN<span class="sc">/</span>exprimes)</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="co"># De façon raccourcie, il est possible de réaliser de la façon suivante:</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="co"># - en utilisant des pivot (tidyr) et un group by</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="co"># data&lt;-data %&gt;%</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a><span class="co">#   pivot_longer(cols= 8:19,names_to ="candidat", values_to = "voix" ) %&gt;%</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(voix=voix/exprimes) %&gt;%</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a><span class="co">#   pivot_wider(values_from = "voix", names_from = "candidat")</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a><span class="co"># - de façon encore plus synthétique, en utilisant un across:</span></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a><span class="co"># data&lt;-data %&gt;%</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a><span class="co">#  mutate(across(8:19, ~ . /exprimes))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="première-visualisation-des-données" class="level1">
<h1>3. Première visualisation des données</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>communes_voix<span class="ot">&lt;-</span>communes <span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(data, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"insee"</span><span class="ot">=</span><span class="st">"codecommune"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="une-carte-par-variable" class="level2">
<h2 class="anchored" data-anchor-id="une-carte-par-variable">3.1. Une carte par variable</h2>
<p>On peut réaliser une carte pour chaque candidat:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">12</span><span class="sc">:</span><span class="dv">23</span>) {</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mf_export(x = communes_voix ,</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#           filename =paste0("TP09/cartes_candidats/carte_",names(communes_voix)[i],".png" ),</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#           width = 900)</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mf_map</span>(<span class="at">x =</span> communes_voix, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">border =</span> <span class="st">"gray25"</span>, <span class="at">lwd =</span> <span class="fl">0.1</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mf_map</span>(<span class="at">x =</span> departements_Paris, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">border =</span> <span class="st">"gray25"</span>, <span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">add=</span>T)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mf_map</span>(communes_voix ,</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">var=</span> <span class="fu">c</span>(<span class="fu">names</span>(communes_voix)[i], <span class="fu">names</span>(communes_voix)[i<span class="sc">+</span><span class="dv">12</span>]),</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>         <span class="co">#val_max=max(unlist(communes_voix[,11:22])),</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">type=</span><span class="st">"prop_choro"</span>,</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">pal=</span><span class="st">"Viridis"</span>,</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">inches=</span><span class="fl">0.1</span>,</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">add=</span>T)</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#dev.off()</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>184 '0' values are not plotted on the map.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="TP9_ACP_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>101 '0' values are not plotted on the map.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="TP9_ACP_files/figure-html/unnamed-chunk-11-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>42 '0' values are not plotted on the map.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="TP9_ACP_files/figure-html/unnamed-chunk-11-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="TP9_ACP_files/figure-html/unnamed-chunk-11-4.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>8 '0' values are not plotted on the map.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="TP9_ACP_files/figure-html/unnamed-chunk-11-5.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>97 '0' values are not plotted on the map.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="TP9_ACP_files/figure-html/unnamed-chunk-11-6.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>18 '0' values are not plotted on the map.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="TP9_ACP_files/figure-html/unnamed-chunk-11-7.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="TP9_ACP_files/figure-html/unnamed-chunk-11-8.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="TP9_ACP_files/figure-html/unnamed-chunk-11-9.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="TP9_ACP_files/figure-html/unnamed-chunk-11-10.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>19 '0' values are not plotted on the map.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="TP9_ACP_files/figure-html/unnamed-chunk-11-11.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="TP9_ACP_files/figure-html/unnamed-chunk-11-12.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(i)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="matrice-de-corrélation" class="level2">
<h2 class="anchored" data-anchor-id="matrice-de-corrélation">3.2. Matrice de corrélation</h2>
<p>On peut réaliser une matrice de corrélation:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>cor.mat <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">cor</span>(data[,<span class="dv">20</span><span class="sc">:</span><span class="dv">31</span>], <span class="at">use=</span><span class="st">"complete.obs"</span>),<span class="dv">2</span>) <span class="co"># round(,2) permet d'arrondir à deux décimale et use="complete.obs" permet d'exclure les NA</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>cor.mat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             ARTHAUD POUTOU ROUSSEL MELENCHON JADOT HIDALGO LASSALLE MACRON
ARTHAUD         1.00   0.09    0.05      0.05 -0.16   -0.04     0.08  -0.29
POUTOU          0.09   1.00    0.14      0.00 -0.06   -0.03     0.10  -0.24
ROUSSEL         0.05   0.14    1.00      0.17 -0.01    0.12     0.01  -0.22
MELENCHON       0.05   0.00    0.17      1.00 -0.15    0.11    -0.35  -0.29
JADOT          -0.16  -0.06   -0.01     -0.15  1.00    0.33    -0.06   0.58
HIDALGO        -0.04  -0.03    0.12      0.11  0.33    1.00    -0.07   0.20
LASSALLE        0.08   0.10    0.01     -0.35 -0.06   -0.07     1.00  -0.17
MACRON         -0.29  -0.24   -0.22     -0.29  0.58    0.20    -0.17   1.00
PECRESSE       -0.13  -0.07   -0.26     -0.54  0.06   -0.11     0.08   0.25
ZEMMOUR        -0.07  -0.13   -0.27     -0.53  0.10   -0.14     0.14   0.25
DUPONTAIGNAN    0.05   0.06    0.09     -0.29 -0.07   -0.11     0.16  -0.16
MLEPEN          0.20   0.17    0.03     -0.40 -0.54   -0.31     0.31  -0.68
             PECRESSE ZEMMOUR DUPONTAIGNAN MLEPEN
ARTHAUD         -0.13   -0.07         0.05   0.20
POUTOU          -0.07   -0.13         0.06   0.17
ROUSSEL         -0.26   -0.27         0.09   0.03
MELENCHON       -0.54   -0.53        -0.29  -0.40
JADOT            0.06    0.10        -0.07  -0.54
HIDALGO         -0.11   -0.14        -0.11  -0.31
LASSALLE         0.08    0.14         0.16   0.31
MACRON           0.25    0.25        -0.16  -0.68
PECRESSE         1.00    0.32        -0.02  -0.03
ZEMMOUR          0.32    1.00        -0.01  -0.03
DUPONTAIGNAN    -0.02   -0.01         1.00   0.29
MLEPEN          -0.03   -0.03         0.29   1.00</code></pre>
</div>
</div>
<p>Le package corrplot permet de visualiser cette matrice de corrélation de façon plus intuitive:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"corrplot"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>corrplot 0.94 loaded</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(cor.mat, <span class="at">tl.col=</span><span class="st">"black"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="TP9_ACP_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>On peut exporter le résultat avec la fonction png de la façon suivante:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">#png(file="TP09/matrice_correlation.png", width = 1000, height = 1000)</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(cor.mat, <span class="at">tl.col=</span><span class="st">"black"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="TP9_ACP_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">#dev.off()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On voit entre autres des corrélations :</p>
<ul>
<li><p>positives entre :</p>
<ul>
<li><p>le vote pour Hidalgo, Jadot et Macron,</p></li>
<li><p>le vote Pécresse, Zemmour et Macron</p></li>
</ul></li>
<li><p>négative entre:</p>
<ul>
<li><p>le vote Marine Le Pen et le vote Jadot-Macron</p></li>
<li><p>le vote Mélanchon et le vote Pecresse-Zemmour</p></li>
</ul></li>
</ul>
<p>Très peu de corrélation entre les vote Zemmour et Marine Lepene.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(cor.mat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="réaliser-lacp" class="level1">
<h1>4. Réaliser l’ACP</h1>
<section id="une-acp-non-pondérée" class="level2">
<h2 class="anchored" data-anchor-id="une-acp-non-pondérée">4.1. Une ACP non pondérée</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>pca<span class="ot">&lt;-</span><span class="fu">PCA</span>(data[,<span class="dv">20</span><span class="sc">:</span><span class="dv">31</span>], <span class="at">graph=</span>T, <span class="at">ncp =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="TP9_ACP_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="TP9_ACP_files/figure-html/unnamed-chunk-16-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>L’objet pca est une liste dans lequel se trouve tous les résultats de l’ACP. On peut y accéder directement ou utiliser des fonctions préfaites pour visualiser les résultats:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># name               description</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 1  "$eig"             "eigenvalues"</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 2  "$var"             "results for the variables"</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 3  "$var$coord"       "coord. for the variables"</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 4  "$var$cor"         "correlations variables - dimensions"</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 5  "$var$cos2"        "cos2 for the variables"</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 6  "$var$contrib"     "contributions of the variables"</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 7  "$ind"             "results for the individuals"</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 8  "$ind$coord"       "coord. for the individuals"</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 9  "$ind$cos2"        "cos2 for the individuals"</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 10 "$ind$contrib"     "contributions of the individuals"</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 11 "$call"            "summary statistics"</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 12 "$call$centre"     "mean of the variables"</span></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 13 "$call$ecart.type" "standard error of the variables"</span></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 14 "$call$row.w"      "weights for the individuals"</span></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 15 "$call$col.w"      "weights for the variables"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="pondérer-le-calcul-de-lacp" class="level2">
<h2 class="anchored" data-anchor-id="pondérer-le-calcul-de-lacp">4.2. Pondérer le calcul de l’ACP</h2>
<p>Dans le cas précédent chacuns des individus à le même poid et chaque variable également. On peut décider de modifier les poids.</p>
<p>Pourtant, il existe de grandes différences entre communes:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mf_export(x = communes_voix ,</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="co">#           filename =paste0("TP09/cartes_votes_exprimes.png" ),</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="co">#           width = 900)</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(<span class="at">x =</span> communes_voix, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">border =</span> <span class="st">"gray25"</span>, <span class="at">lwd =</span> <span class="fl">0.1</span>)</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(<span class="at">x =</span> departements_Paris, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">border =</span> <span class="st">"gray25"</span>, <span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">add=</span>T)</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(communes_voix ,</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">var=</span> <span class="st">"exprimes"</span>,</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">type=</span><span class="st">"prop"</span>,</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">inches=</span><span class="fl">0.1</span>,</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">add=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="TP9_ACP_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">#dev.off()</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(communes_voix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Si on souhaite pondérer les entités on peut utiliser “row.w =”:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>pca<span class="ot">&lt;-</span><span class="fu">PCA</span>(data[,<span class="dv">20</span><span class="sc">:</span><span class="dv">31</span>], <span class="at">row.w =</span>data<span class="sc">$</span>exprimes,<span class="at">ncp =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="TP9_ACP_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="TP9_ACP_files/figure-html/unnamed-chunk-19-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Pour pondérer les variables on peut utiliser col.w Attention: pour pondérer, il faut que tous les poids soient &gt;0. Dans le cas présent ça ne pose pas de problème.</p>
</section>
</section>
<section id="visualiser-les-résultats" class="level1">
<h1>5. Visualiser les résultats</h1>
<section id="cercles-de-corrélation" class="level2">
<h2 class="anchored" data-anchor-id="cercles-de-corrélation">5.1. Cercles de corrélation</h2>
<p>Ce résultat sont stocker dans l’objet pca:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>pca<span class="sc">$</span>var<span class="sc">$</span>coord</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   Dim.1        Dim.2        Dim.3       Dim.4       Dim.5
ARTHAUD       0.75783970  0.193700662  0.053886556 -0.33202051  0.22476966
POUTOU        0.70415312  0.004765184  0.418058777 -0.07460159  0.23692366
ROUSSEL       0.66687033 -0.124984377  0.299327347  0.62640195  0.14923271
MELENCHON     0.74370403 -0.538863968 -0.340415783 -0.02007377 -0.09595007
JADOT        -0.45229731 -0.533488252  0.663311687 -0.03924331 -0.01890221
HIDALGO      -0.10246245 -0.687312206  0.620349032 -0.17878940 -0.04634065
LASSALLE      0.07686699  0.764044366  0.449976355 -0.03134172  0.14026444
MACRON       -0.94011924 -0.048504652  0.166318959  0.02380460  0.02352660
PECRESSE     -0.88585300  0.321419606 -0.009943942  0.04293183  0.14109764
ZEMMOUR      -0.79129943  0.372205374 -0.100007056  0.06375980  0.19413646
DUPONTAIGNAN  0.19419953  0.681063286  0.357058840  0.04326915 -0.55375208
MLEPEN        0.45088539  0.809295495  0.102917819 -0.06620236  0.04182531
                    Dim.6       Dim.7       Dim.8         Dim.9       Dim.10
ARTHAUD      -0.270976655  0.38461093 -0.05343325 -0.0045179775 -0.008370156
POUTOU        0.499863557  0.02458871 -0.12931404 -0.0007009491  0.015475982
ROUSSEL      -0.131302409  0.12543543  0.02976306 -0.0269964797  0.028203308
MELENCHON     0.007735581 -0.03917968 -0.02553644  0.1644913917  0.010914950
JADOT        -0.069747306  0.01101491 -0.04680005 -0.0019169799 -0.225853682
HIDALGO      -0.040984394 -0.01196939  0.24982650  0.0054539159  0.183340122
LASSALLE     -0.191952534 -0.29553028 -0.08181916  0.2339225539  0.025984130
MACRON       -0.043682377  0.04938810 -0.18414230 -0.1216818436  0.031798367
PECRESSE      0.017812438  0.11278338 -0.11425240 -0.0094676328  0.152069481
ZEMMOUR       0.158100636  0.20993077  0.27169444  0.1793777244 -0.079291052
DUPONTAIGNAN  0.082126654  0.22599626 -0.03151295  0.0577028315  0.017115750
MLEPEN       -0.004296971 -0.15138365  0.19561196 -0.2456237780 -0.040599884
                    Dim.11       Dim.12
ARTHAUD      -0.0140271624 3.282270e-10
POUTOU       -0.0156209607 3.891439e-10
ROUSSEL      -0.0056358853 1.336890e-09
MELENCHON     0.0401760796 2.360485e-08
JADOT         0.1036719950 3.831603e-09
HIDALGO      -0.0166654983 1.030643e-09
LASSALLE     -0.0303200827 9.593980e-10
MACRON       -0.1759761971 1.521580e-08
PECRESSE      0.2019841257 5.393004e-09
ZEMMOUR      -0.0469535055 5.553946e-09
DUPONTAIGNAN  0.0000869299 1.563518e-09
MLEPEN        0.0428961375 1.323804e-08</code></pre>
</div>
</div>
<p>Les cercle de corrélation permettent de visualiser entre les variables et les dimensions produites par l’ACP.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>cercle_1_2<span class="ot">&lt;-</span><span class="fu">fviz_pca_var</span>(pca,  <span class="at">axes =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))<span class="sc">+</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>cercle_1_2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="TP9_ACP_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ggsave(cercle_1_2,filename="TP09/cercle_correlation_1_2.png", width=7, height=7, bg="white")</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="co">#rm(cercle_1_2)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On peut décider de visualiser d’autres axes en modifiant le paramètre axes:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>cercle_1_3<span class="ot">&lt;-</span><span class="fu">fviz_pca_var</span>(pca,  <span class="at">axes =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))<span class="sc">+</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>cercle_1_3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="TP9_ACP_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ggsave(cercle_1_3,filename="TP09/cercle_correlation_1_3.png", width=7, height=7, bg="white")</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="co">#rm(cercle_1_3)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Pour faciliter la lecture, on peut inverser un axe en multipliant par -1 (dans notre cas, il est plus intuitif d’avoir la gauche politique à gauche et la droite à droite):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>pca<span class="sc">$</span>var<span class="sc">$</span>coord[,<span class="dv">1</span>]<span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span><span class="sc">*</span>pca<span class="sc">$</span>var<span class="sc">$</span>coord[,<span class="dv">1</span>]</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>cercle_1_2<span class="ot">&lt;-</span><span class="fu">fviz_pca_var</span>(pca,  <span class="at">axes =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>) )<span class="sc">+</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>cercle_1_2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="TP9_ACP_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ggsave(cercle_1_2,filename="TP09/cercle_correlation_1_2.png", width=7, height=7, bg="white")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Il faut alors aussi le faire sur les coordonnées des individus:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>pca<span class="sc">$</span>ind<span class="sc">$</span>coord[,<span class="dv">1</span>]<span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span><span class="sc">*</span> pca<span class="sc">$</span>ind<span class="sc">$</span>coord[,<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On peut décider de ne pas afficher toutes les variables (si il y en a trop ça devient illisible). Ici, on décide d’afficher surtout (en modifiant la tranparance) celles qui ont le plus contribué à la construction de les deux axes (alpha.var=“contrib”) ou celle qui sont le plus prise en compte par les deux axes (alpha.var=“cos2”), soit encore de sélectionner celles qui ont un cos2 supérieur à un seuil (select.var = list(cos2 = 0.75) ) ou les 3 qui contribuent le plus (select.var = list(contrib = 3))):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_pca_var</span>(pca,  <span class="at">axes =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">alpha.var=</span><span class="st">"contrib"</span>)<span class="sc">+</span><span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="TP9_ACP_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_pca_var</span>(pca,  <span class="at">axes =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">alpha.var=</span><span class="st">"cos2"</span>)<span class="sc">+</span> <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="TP9_ACP_files/figure-html/unnamed-chunk-25-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_pca_var</span>(pca,  <span class="at">axes =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">select.var =</span> <span class="fu">list</span>(<span class="at">cos2 =</span> <span class="fl">0.75</span>))<span class="sc">+</span> <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="TP9_ACP_files/figure-html/unnamed-chunk-25-3.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_pca_var</span>(pca,  <span class="at">axes =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">select.var =</span> <span class="fu">list</span>(<span class="at">contrib =</span> <span class="dv">3</span>))<span class="sc">+</span> <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="TP9_ACP_files/figure-html/unnamed-chunk-25-4.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Il est peut aussi être pertinent d’utiliser l’argument repel=T pour utiliser le package repel pour les étiquettes et éviter qu’elle ne se chevauches:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_pca_var</span>(pca,  <span class="at">axes =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">repel=</span>T )<span class="sc">+</span>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="TP9_ACP_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="contributions-de-chaque-variables" class="level2">
<h2 class="anchored" data-anchor-id="contributions-de-chaque-variables">5.2. Contributions de chaque variables</h2>
<p>La contribution de chaque variable à la construction de chacune de dimension:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>pca<span class="sc">$</span>var<span class="sc">$</span>contrib</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  Dim.1        Dim.2        Dim.3       Dim.4       Dim.5
ARTHAUD      11.9038406 1.231246e+00  0.183052896 19.83392132  9.58930308
POUTOU       10.2770061 7.451467e-04 11.017687192  1.00132471 10.65438844
ROUSSEL       9.2175433 5.126181e-01  5.648180142 70.59679126  4.22707266
MELENCHON    11.4639072 9.528856e+00  7.305250657  0.07249975  1.74743980
JADOT         4.2401420 9.339684e+00 27.736460944  0.27708309  0.06781672
HIDALGO       0.2176015 1.550210e+01 24.259841866  5.75125091  0.40760167
LASSALLE      0.1224650 1.915665e+01 12.764245064  0.17673574  3.73427942
MACRON       18.3188531 7.720568e-02  1.743810408  0.10195308  0.10505823
PECRESSE     16.2650617 3.390215e+00  0.006233513  0.33161753  3.77877609
ZEMMOUR      12.9781893 4.546192e+00  0.630488306  0.73142974  7.15362007
DUPONTAIGNAN  0.7816796 1.522150e+01  8.037025154  0.33684917 58.20260409
MLEPEN        4.2137107 2.149298e+01  0.667723858  0.78854370  0.33203971
                    Dim.6       Dim.7      Dim.8        Dim.9      Dim.10
ARTHAUD      17.567987257 38.26088046  1.1309610 1.056017e-02  0.05892929
POUTOU       59.780728472  0.15638066  6.6239329 2.541885e-04  0.20145614
ROUSSEL       4.124807104  4.06960429  0.3508970 3.770484e-01  0.66905864
MELENCHON     0.014316739  0.39703930  0.2583124 1.399810e+01  0.10020919
JADOT         1.163893177  0.03138149  0.8675954 1.901157e-03 42.90604037
HIDALGO       0.401878970  0.03705574 24.7230208 1.538862e-02 28.27347030
LASSALLE      8.815479728 22.58997116  2.6517620 2.830917e+01  0.56791122
MACRON        0.456531526  0.63089386 13.4317208 7.660100e+00  0.85049882
PECRESSE      0.075911050  3.29004564  5.1707694 4.637305e-02 19.45128139
ZEMMOUR       5.980334606 11.39892589 29.2405834 1.664638e+01  5.28825575
DUPONTAIGNAN  1.613713804 13.21034744  0.3933712 1.722571e+00  0.24640866
MLEPEN        0.004417566  5.92747407 15.1570737 3.121215e+01  1.38648022
                   Dim.11      Dim.12
ARTHAUD      2.190093e-01  0.01030897
POUTOU       2.716054e-01  0.01449063
ROUSSEL      3.535471e-02  0.17102445
MELENCHON    1.796628e+00 53.31743705
JADOT        1.196316e+01  1.40484268
HIDALGO      3.091431e-01  0.10164445
LASSALLE     1.023255e+00  0.08807739
MACRON       3.446917e+01 22.15420622
PECRESSE     4.541062e+01  2.78309654
ZEMMOUR      2.453912e+00  2.95168558
DUPONTAIGNAN 8.411265e-06  0.23392274
MLEPEN       2.048139e+00 16.76926331</code></pre>
</div>
</div>
<p>On peut également afficher de façon graphique avec fviz_contrib:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_contrib</span>(pca, <span class="at">choice =</span> <span class="st">"var"</span>, <span class="at">axes =</span> <span class="dv">1</span>, <span class="at">top =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="TP9_ACP_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_contrib</span>(pca, <span class="at">choice =</span> <span class="st">"var"</span>, <span class="at">axes =</span> <span class="dv">2</span>, <span class="at">top =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="TP9_ACP_files/figure-html/unnamed-chunk-28-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="valeurs-propres-et-de-la-variance-expliquée" class="level2">
<h2 class="anchored" data-anchor-id="valeurs-propres-et-de-la-variance-expliquée">5.3. Valeurs propres et % de la variance expliquée</h2>
<p>Pour afficher les valeurs propres (eigen value) et le pourcentage de variance expliquée, on peut simplement afficher le tableau compris dans l’objet pca</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>pca<span class="sc">$</span>eig</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          eigenvalue percentage of variance cumulative percentage of variance
comp 1  4.824670e+00           4.020558e+01                          40.20558
comp 2  3.047316e+00           2.539430e+01                          65.59988
comp 3  1.586296e+00           1.321913e+01                          78.81902
comp 4  5.558034e-01           4.631695e+00                          83.45071
comp 5  5.268516e-01           4.390430e+00                          87.84114
comp 6  4.179668e-01           3.483056e+00                          91.32420
comp 7  3.866235e-01           3.221863e+00                          94.54606
comp 8  2.524500e-01           2.103750e+00                          96.64981
comp 9  1.932934e-01           1.610779e+00                          98.26059
comp 10 1.188874e-01           9.907285e-01                          99.25132
comp 11 8.984151e-02           7.486793e-01                         100.00000
comp 12 1.045041e-15           8.708673e-15                         100.00000</code></pre>
</div>
</div>
<p>On peut faire un graphique de la variance expliquées:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_screeplot</span>(pca, <span class="at">ncp=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="TP9_ACP_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Ces informations sont utiles pour nous aider à décider combien de composante retenir. Généralement, on s’arrange avec ces règles non-strictes: - eigenvalue &gt; 1 - variance cumulée &gt; 70% - gain faible d’une composante supplémentaire (ajouter une dimension supplémentaire ne permet pas de gagner beaucoup en variance expliquée)</p>
</section>
<section id="carte-de-scores" class="level2">
<h2 class="anchored" data-anchor-id="carte-de-scores">5.4. Carte de scores</h2>
<p>Chaque individus est reprojeter sur les nouvelles dimensions. Leurs scores sont stocké dans l’objet pca:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pca<span class="sc">$</span>ind<span class="sc">$</span>coord)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Dim.1      Dim.2       Dim.3        Dim.4       Dim.5      Dim.6
1 3.067555 -1.7114152  0.08150264 -0.185735850 -0.41247012 -0.1498315
2 2.511828 -2.7064534  0.70245008 -0.193923389 -0.70891924 -0.4567220
3 2.031107 -3.0966114  1.07311078 -0.404287195 -0.18691460 -0.5270521
4 2.201343 -2.4124210  1.18680228 -0.001301227 -0.20907736  0.2881203
5 1.991101 -2.2577563  1.02941720 -0.014047196 -0.02204558 -0.1995434
6 3.955340 -0.8826657 -0.20675170  0.106337247  0.01854102 -0.1812643
        Dim.7       Dim.8      Dim.9      Dim.10      Dim.11        Dim.12
1 -0.31386218  0.51897558 -0.4392267  0.16799431 -0.45550607 -2.122990e-09
2 -0.53505432  0.36256495 -0.6205415 -0.13143940 -0.64944655 -2.768542e-09
3 -0.32566793  0.04083631 -0.7457277 -0.17322620 -0.51307636 -6.765777e-09
4 -0.18494092  0.55795434 -0.3835738  0.18158093 -0.51829968 -1.631543e-09
5 -0.07027549  0.24404548 -0.1594431  0.07828135 -0.03678451 -1.845831e-09
6  0.07415939 -0.23014907 -0.3167121  0.16569411 -0.35174294 -2.268829e-09</code></pre>
</div>
</div>
<p>On peut souhaiter les visualiser dans un graphique à deux dimensions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_pca_ind</span>(pca)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="TP9_ACP_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Forcément cela à du sens que si on a peu d’individus. Si les individus sont des entités géographiques, on peut souhaiter en faire des cartes.</p>
<p>On peut récupérer les score de chaque individus en collant avec bind_rows les coordonnées avec le set de données initiale. On doit utiliser ici bind_rows plutôt qu’une jointure (left_join, right_join) parce que l’agorythme de FactoMineR ne conserve pas d’ID lors de la réalisation de l’ACP mais il conserve bien l’ordre des lignes mise en entrée:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>data_pca<span class="ot">&lt;-</span><span class="fu">bind_cols</span>(data,</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>                    pca<span class="sc">$</span>ind<span class="sc">$</span>coord)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On réalise une boucle pour visualiser les 3 premières dimensions en faisant d’abord la jointure entre nos résultats et l’objet commune:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>communes_pca<span class="ot">&lt;-</span>communes <span class="sc">%&gt;%</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(data_pca, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"insee"</span><span class="ot">=</span><span class="st">"codecommune"</span>))</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>){</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mf_export(x = communes_pca ,</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#           filename =paste0("TP09/carte_acp_dim",i,".png" ),</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#           width = 900)</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mf_map</span>(communes_pca ,</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">var=</span> <span class="fu">paste0</span>(<span class="st">"Dim."</span>,i),</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">type=</span><span class="st">"choro"</span>,</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">pal=</span> <span class="st">"Viridis"</span>,</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">lwd=</span><span class="fl">0.001</span>)</span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mf_map</span>(<span class="at">x =</span> departements_Paris, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">border =</span> <span class="st">"gray25"</span>, <span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">add=</span>T)</span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># dev.off()</span></span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="TP9_ACP_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="TP9_ACP_files/figure-html/unnamed-chunk-34-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="TP9_ACP_files/figure-html/unnamed-chunk-34-3.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(i,communes_pca)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="ajouter-des-variables-supplémentaires" class="level1">
<h1>6. Ajouter des variables supplémentaires</h1>
<p>Pour aider à l’interprétation des axes, il peut être utile d’importer des nouvelles variables qui ne seront pas utilisées dans l’ACP mais qu’on pourra néanmoins utiliser comme repère.</p>
<section id="importation-des-données-1" class="level2">
<h2 class="anchored" data-anchor-id="importation-des-données-1">6.1. Importation des données</h2>
<section id="population" class="level3">
<h3 class="anchored" data-anchor-id="population">6.1.1. Population</h3>
<p>On importe les données de population:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>pop<span class="ot">&lt;-</span><span class="fu">read_excel</span>(<span class="st">"../data/France/population_insee_2021.xlsx"</span>, <span class="at">sheet=</span><span class="st">"Communes"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">codecommune=</span><span class="fu">paste0</span>(<span class="st">`</span><span class="at">Code département</span><span class="st">`</span>, <span class="st">`</span><span class="at">Code commune</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="st">`</span><span class="at">Code région</span><span class="st">`</span><span class="sc">==</span><span class="st">"11"</span>) <span class="co"># on garde que la France métropolitaine</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On joint avec le fichier spatial des communes et calcul la densité de population</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>communes_pop<span class="ot">&lt;-</span> communes <span class="sc">%&gt;%</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(pop, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"insee"</span><span class="ot">=</span><span class="st">"codecommune"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">densite_ha=</span><span class="st">`</span><span class="at">Population totale</span><span class="st">`</span><span class="sc">/</span>surface) <span class="sc">%&gt;%</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(insee, densite_ha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On peut réaliser une carte de la densité de population</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mf_export(x = communes_pop ,</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="co">#           filename =paste0("TP09/carte_densite.png" ),</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="co">#           width = 900)</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(communes_pop ,</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">var=</span> <span class="st">"densite_ha"</span>,</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">type=</span><span class="st">"choro"</span>,</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">pal=</span> <span class="st">"Viridis"</span>,</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd=</span><span class="fl">0.001</span>)</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(<span class="at">x =</span> departements_Paris, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">border =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">add=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="TP9_ACP_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co">#dev.off()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On enlève transforme l’objet en dataframe et on enlève la colonne geom:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>communes_pop_df<span class="ot">&lt;-</span>communes_pop <span class="sc">%&gt;%</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>geom)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On réalise la jointure avec les données de base:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>data<span class="ot">&lt;-</span>data <span class="sc">%&gt;%</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(communes_pop_df, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"codecommune"</span><span class="ot">=</span><span class="st">"insee"</span>))</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(pop,communes_pop, communes_pop_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="revenus" class="level3">
<h3 class="anchored" data-anchor-id="revenus">6.1.2. Revenus</h3>
<p>On importe les données de revenus, on conserve les champ qui nous intéresse et on transforme le champ revenu médian en “numeric”:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>revenus<span class="ot">&lt;-</span><span class="fu">read_excel</span>(<span class="st">"../data/France/FILO2021_DEC_COM.xlsx"</span>, <span class="at">sheet=</span><span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">revenus=</span><span class="fu">as.numeric</span>(revenu_median)) <span class="sc">%&gt;%</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CODGEO, revenus)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On joint avec le fichier spatial des communes et les revenus:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>communes_revenus<span class="ot">&lt;-</span> communes <span class="sc">%&gt;%</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(revenus, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"insee"</span><span class="ot">=</span><span class="st">"CODGEO"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On peut réaliser une carte de revenu:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mf_export(x = communes_revenus ,</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="co">#           filename =paste0("TP09/carte_revenus.png" ),</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="co">#           width = 900)</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(communes_revenus ,</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">var=</span> <span class="st">"revenus"</span>,</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">type=</span><span class="st">"choro"</span>,</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">pal=</span> <span class="st">"Viridis"</span>,</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd=</span><span class="fl">0.001</span>)</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(<span class="at">x =</span> departements_Paris, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">border =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">add=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="TP9_ACP_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co">#dev.off()</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(communes_revenus)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On réalise la jointure avec les données de base:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>data<span class="ot">&lt;-</span>data <span class="sc">%&gt;%</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(revenus, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"codecommune"</span><span class="ot">=</span><span class="st">"CODGEO"</span>))</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(revenus)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="acp-avec-les-variables-supplémentaires" class="level2">
<h2 class="anchored" data-anchor-id="acp-avec-les-variables-supplémentaires">6.2. ACP avec les variables supplémentaires</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>pca<span class="ot">&lt;-</span><span class="fu">PCA</span>(data[,<span class="dv">20</span><span class="sc">:</span><span class="dv">33</span>], <span class="at">quanti.sup =</span> <span class="dv">13</span><span class="sc">:</span><span class="dv">14</span>, <span class="at">row.w =</span>data<span class="sc">$</span>exprimes, <span class="at">graph=</span>F, <span class="at">ncp =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in PCA(data[, 20:33], quanti.sup = 13:14, row.w = data$exprimes, :
Missing values are imputed by the mean of the variable: you should use the
imputePCA function of the missMDA package</code></pre>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>cercle_1_2<span class="ot">&lt;-</span><span class="fu">fviz_pca_var</span>(pca,  <span class="at">axes =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))<span class="sc">+</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>cercle_1_2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="TP9_ACP_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ggsave(cercle_1_2,filename="TP09/cercle_correlation_1_2_revenu_pop.png", width=7, height=7, bg="white")</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(cercle_1_2)</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>cercle_1_3<span class="ot">&lt;-</span><span class="fu">fviz_pca_var</span>(pca,  <span class="at">axes =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))<span class="sc">+</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>cercle_1_3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="TP9_ACP_files/figure-html/unnamed-chunk-44-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ggsave(cercle_1_3,filename="TP09/cercle_correlation_1_3_revenu_pop.png", width=7, height=7, bg="white")</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(cercle_1_3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On observe des fortes corrélations entre la première dimension qui dépeind une opposition gauche-droite et la variable de revenus, les revenus élevés étant associés aux communes où le vote de droite est important. La seconde dimension est quant à elle fortement corrélée à la densité de population et permet d’interprétée cette dernière comme l’opposition centre urbain-périphérie</p>
</section>
</section>
<section id="aller-plus-loin" class="level1">
<h1>7. Aller plus loin</h1>
<p>Il est possible de faire des ACP sur des données d’enquêtes soit en utilisant les poids comme présenté précédement soit grâce au package :svyprcomp (<a href="https://r-survey.r-forge.r-project.org/survey/html/svyprcomp.html" class="uri">https://r-survey.r-forge.r-project.org/survey/html/svyprcomp.html</a>)</p>
<p>On peut vouloir réaliser des légères rotations des axes pour améliorer la lecture des axes: <a href="https://stats.stackexchange.com/questions/59213/how-to-compute-varimax-rotated-principal-components-in-r%20https://dimension.usherbrooke.ca/pages/87">https://stats.stackexchange.com/questions/59213/how-to-compute-varimax-rotated-principal-components-in-r https://dimension.usherbrooke.ca/pages/87</a></p>
<p><a href="https://sites.google.com/site/rgraphiques/4--stat/machine-learning-biostatistiques-analyse-de-donn%C3%A9es/analyse-en-composantes-principales/la-rotation-varimax" class="uri">https://sites.google.com/site/rgraphiques/4--stat/machine-learning-biostatistiques-analyse-de-donn%C3%A9es/analyse-en-composantes-principales/la-rotation-varimax</a></p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>